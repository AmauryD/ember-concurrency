<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>ember-concurrency</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
<meta name="dummy/config/environment" content="%7B%22modulePrefix%22%3A%22dummy%22%2C%22environment%22%3A%22production%22%2C%22rootURL%22%3A%22%2F%22%2C%22locationType%22%3A%22auto%22%2C%22EmberENV%22%3A%7B%22FEATURES%22%3A%7B%7D%2C%22EXTEND_PROTOTYPES%22%3A%7B%22Date%22%3Afalse%7D%2C%22_JQUERY_INTEGRATION%22%3Atrue%7D%2C%22APP%22%3A%7B%22name%22%3A%22ember-concurrency%22%2C%22version%22%3A%221.2.0%2Bd066cd71%22%7D%2C%22fastboot%22%3A%7B%22hostWhitelist%22%3A%5B%7B%7D%2C%22ember-concurrency.com%22%5D%7D%2C%22exportApplicationGlobal%22%3Afalse%7D" />
<!-- EMBER_CLI_FASTBOOT_TITLE -->

    <link integrity="" rel="stylesheet" href="/assets/vendor-e754b247f0b14ad5fde0f302404dd7cb.css">
    <link integrity="" rel="stylesheet" href="/assets/dummy-640694e3930703a2e7f6ed809d9835b0.css">
    <link href='//fonts.googleapis.com/css?family=Raleway:400,300,600' rel='stylesheet' type='text/css'>

    
  </head>
  <body>
    <script type="x/boundary" id="fastboot-body-start"></script><div class="ember-view" id="ember646"><div class="container navbar">
  <div class="row">
    <div class="ten columns">
      <h3 style="float:left;">
        ember-concurrency

        <span style="font-size: 0.5em;">
          (v 1.2.0)
        </span>
      </h3>
    </div>
    <div class="one columns">
      <div class="nav-bar-link-outer">
        <a href="/api">API</a>
      </div>
    </div>
    <div class="one columns">
      <div class="nav-bar-link-outer">
        <a href="https://github.com/machty/ember-concurrency" target="_blank" rel="noopener">GitHub</a>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="docs row">
    <div class="three columns">
      <div class="side-menu">
            <div class="toc-entry">
                <a href="/docs/introduction" id="ember647" class="ember-view">Home</a>
            </div>


<!---->            <div class="toc-entry">
                <a href="/docs/installation" id="ember648" class="ember-view">Installation</a>
            </div>


<!---->            <div class="toc-section-title">
              Introduction
            </div>
            <div class="toc-entry">
                <a href="/docs/tutorial" id="ember649" class="ember-view">Writing Code Without Tasks</a>
            </div>


<!---->            <div class="toc-entry">
                <a href="/docs/tutorial/discussion" id="ember650" class="ember-view">Post-Mortem</a>
            </div>


<!---->            <div class="toc-entry">
                <a href="/docs/tutorial/refactor" id="ember651" class="ember-view">Refactoring With Tasks</a>
            </div>


<!---->            <div class="toc-section-title">
              Reference
            </div>
            <div class="toc-entry">
                <a href="/docs/task-function-syntax" id="ember652" class="ember-view">Task Function Syntax</a>
            </div>


<!---->            <div class="toc-entry">
                <a href="/docs/task-concurrency" id="ember653" class="ember-view">Managing Task Concurrency</a>
            </div>


                <div class="toc-entry toc-subentry">
                  <a href="/docs/task-concurrency-advanced" id="ember654" class="ember-view">Advanced</a>
                </div>
            <div class="toc-entry">
                <a href="/docs/cancelation" id="ember655" class="ember-view">Cancelation</a>
            </div>


<!---->            <div class="toc-entry">
                <a href="/docs/error-vs-cancelation" id="ember656" class="ember-view">Handling Errors</a>
            </div>


<!---->            <div class="toc-entry">
                <a href="/docs/child-tasks" id="ember657" class="ember-view">Child Tasks</a>
            </div>


<!---->            <div class="toc-entry">
                <a href="/docs/task-groups" id="ember658" class="ember-view">Task Groups</a>
            </div>


<!---->            <div class="toc-entry">
                <a href="/docs/derived-state" id="ember659" class="ember-view">Derived State</a>
            </div>


<!---->            <div class="toc-entry">
                <a href="/docs/encapsulated-task" id="ember660" class="active ember-view">Encapsulated Tasks</a>
            </div>


<!---->            <div class="toc-entry">
                <a href="/docs/events" id="ember661" class="ember-view">Awaiting Events / Conditions</a>
            </div>


<!---->            <div class="toc-entry">
                <a href="/docs/task-lifecycle-events" id="ember662" class="ember-view">Lifecycle Events</a>
            </div>


<!---->            <div class="toc-entry">
                <a href="/docs/testing-debugging" id="ember663" class="ember-view">Testing &amp; Debugging</a>
            </div>


<!---->            <div class="toc-entry">
                <a href="/docs/typescript" id="ember664" class="ember-view">TypeScript</a>
            </div>


<!---->            <div class="toc-entry">
                <a href="/docs/faq" id="ember665" class="ember-view">FAQ &amp; Fact Sheet</a>
            </div>


<!---->            <div class="toc-section-title">
              Examples
            </div>
            <div class="toc-entry">
                <a href="/docs/examples/loading-ui" id="ember666" class="ember-view">Loading UI</a>
            </div>


<!---->            <div class="toc-entry">
                <a href="/docs/examples/autocomplete" id="ember667" class="ember-view">Type-Ahead Search</a>
            </div>


<!---->            <div class="toc-entry">
                <a href="/docs/examples/increment-buttons" id="ember668" class="ember-view">Accelerating Increment Buttons</a>
            </div>


<!---->            <div class="toc-entry">
                <a href="/docs/examples/ajax-throttling" id="ember669" class="ember-view">AJAX Throttling</a>
            </div>


<!---->            <div class="toc-entry">
                <a href="/docs/examples/route-tasks" id="ember670" class="ember-view">Route Tasks</a>
            </div>


<!---->            <div class="toc-entry">
                <a href="/docs/examples/joining-tasks" id="ember671" class="ember-view">Awaiting Multiple Child Tasks</a>
            </div>


<!---->      </div>
    </div>
    <div class="nine columns">
      <div class="row">
    <p class="u-pull-left">
      Previous: <a href="/docs/derived-state" id="ember672" class="ember-view">Derived State</a>
    </p>

    <p class="u-pull-right">
      Next: <a href="/docs/events" id="ember673" class="ember-view">Awaiting Events / Conditions</a>
    </p>
</div>


      <a title="Edit on Github" href="https://github.com/machty/ember-concurrency/edit/master/tests/dummy/app/docs/encapsulated-task/template.hbs" id="ember674" class="github-edit ember-view"><i class="icon-pencil"></i>
</a>

      <h3>Encapsulated Tasks</h3>

<p>
  Normally, you define tasks by passing a generator function to <code>task(...)</code>.
  Often though, you want to be able to expose additional state of the task,
  e.g. you might want to show the percentage progress of an <code>uploadFile</code> task,
  but unless you're using the techniques described below there's no good
  place to expose that data to the template other than to set some properties
  on the host object, but then you lose a lot of the benefits of encapsulation
  in the process.
</p>

<p>
  In cases like these, you can use Encapsulated Tasks, which behave just
  like regular tasks, but with one crucial difference: the value
  of <code>this</code> within the task function points to the currently
  running TaskInstance, rather than the host object that the task lives on
  (e.g. a Component, Controller, etc). This allows for some nice patterns
  where all of the state produced/mutated by a task can be contained (encapsulated)
  <em>within</em> the Task itself, rather than having to live on the host
  object.
</p>

<p>
  To create an encapsulated task, pass an object (instead of a generator function)
  to the <code>task()</code>
  constructor that defines a <code>perform</code> generator function. The
  object can also contain initial values for task state, as well as computed
  properties and anything else supported by classic Ember objects.
</p>

<pre id="ember675" class="javascript ember-view">import { task } from 'ember-concurrency';

export default Component.extend({
  outerFoo: 123,
  regularTask: task(function * (value) {
    // this is a classic/regular ember-concurrency task,
    // which has direct access to the host object that it
    // lives on via `this`
    console.log(this.outerFoo); // =&gt; 123
    yield doSomeAsync();
    this.set('outerFoo', value);
  }),

  encapsulatedTask: task({
    innerFoo: 456,

    // this `*perform() {}` syntax is valid JavaScript shorthand
    // syntax for `perform: function * () {}`

    *perform(value) {
      // this is an encapulated task. It does NOT have
      // direct access to the host object it lives on, but rather
      // only the properties defined within the POJO passed
      // to the `task()` constructor.
      console.log(this.innerFoo); // =&gt; 456

      // `this` is the currently executing TaskInstance, so
      // you can also get classic TaskInstance properties
      // provided by ember-concurrency.
      console.log(this.get('isRunning')); // =&gt; true

      yield doSomeAsync();
      this.set('innerFoo', value);
    },
  })
});
</pre>

<h3>Live Example</h3>

<p>
  This example demonstrates how to use encapsulated tasks to
  model file uploads. It keeps all of the upload state <em>within</em>
  each TaskInstance, and uses <a href="/docs/derived-state" id="ember676" class="ember-view">Derived State</a>
  to expose the values set within the encapsulated tasks.
</p>

<p>
  <button>
    Start Upload
  </button>
</p>

<h5>Queued Uploads: 0</h5>

<!---->
<!---->

<pre id="ember677" class="javascript ember-view">import { task, timeout } from 'ember-concurrency';

export default Controller.extend({
  uploadFile: task({
    progress: 0,
    url: null,

    stateText: computed('progress', function() {
      let progress = this.get('progress');
      if (progress &lt; 49) {
        return "Just started..."
      } else if (progress &lt; 100) {
        return "Halfway there..."
      } else {
        return "Done!"
      }
    }),

    *perform(makeUrl) {
      this.set('url', makeUrl());

      while (this.progress &lt; 100) {
        yield timeout(200);
        let newProgress = this.progress + Math.floor(Math.random() * 6) + 5;
        this.set('progress', Math.min(100, newProgress));
      }

      return "(upload result data)";
    },
  }).enqueue(),

  makeRandomUrl() {
    return `https://www.${randomWord()}.edu`;
  }
});
</pre>
<pre id="ember678" class="htmlbars ember-view">&lt;p&gt;
  &lt;button onclick={{perform uploadFile makeRandomUrl}}&gt;
    Start Upload
  &lt;/button&gt;
&lt;/p&gt;

&lt;h5&gt;Queued Uploads: {{uploadFile.numQueued}}&lt;/h5&gt;

{{#with uploadFile.last as |encapsTask|}}
  &lt;h5&gt;
    Uploading to {{encapsTask.url}} ({{encapsTask.stateText}}):
    {{encapsTask.progress}}%
  &lt;/h5&gt;
{{/with}}

{{#if uploadFile.lastSuccessful}}
  &lt;h5 style="color: green;" {{! template-lint-disable no-inline-styles }}&gt;
    &lt;strong&gt;
      Upload to {{uploadFile.lastSuccessful.url}}:
      {{uploadFile.lastSuccessful.value}}
    &lt;/strong&gt;
  &lt;/h5&gt;
{{/if}}
</pre>


      <br> <br> <br> <br>

      <div class="row">
    <p class="u-pull-left">
      Previous: <a href="/docs/derived-state" id="ember679" class="ember-view">Derived State</a>
    </p>

    <p class="u-pull-right">
      Next: <a href="/docs/events" id="ember680" class="ember-view">Awaiting Events / Conditions</a>
    </p>
</div>


    </div>
  </div>
</div>


<div id="ember681" class="ember-notify-cn ember-notify-default ember-view"><!----></div>
</div><script type="x/boundary" id="fastboot-body-end"></script>

    <script src="/assets/vendor-a60f1c4a4d2f010e6af5cf843cd6ab80.js"></script>
    <script src="/assets/dummy-5f8a1922abdebca46b3ce23e131201e2.js"></script>

    
  </body>
</html>
